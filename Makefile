# -*- makefile-gmake -*-
#################################

# packages, listed in reverse order:
PACKAGES = Ktheory RezkCompletion Foundations

#################################

include Makefile-coq.make
everything: TAGS all html install
OTHERFLAGS += -indices-matter
Packages/Foundations/hlevel2/algebra1b.vo : OTHERFLAGS += -no-sharing
ifeq ($(VERBOSE),yes)
OTHERFLAGS += -verbose
endif
# later: see exactly which files need -no-sharing
NO_SHARING = yes
ifeq ($(NO_SHARING),yes)
OTHERFLAGS += -no-sharing
endif
# TIME = time
COQDOC := $(COQDOC) -utf8
COQC = $(TIME) $(COQBIN)coqc
COQDEFS := --language=none -r '/^[[:space:]]*\(Axiom\|Theorem\|Class\|Instance\|Let\|Ltac\|Definition\|Lemma\|Record\|Remark\|Structure\|Fixpoint\|Fact\|Corollary\|Let\|Inductive\|Coinductive\|Notation\|Proposition\|Module[[:space:]]+Import\|Module\)[[:space:]]+\([[:alnum:]'\''_]+\)/\2/'
TAGS : $(VFILES); etags $(COQDEFS) $^
install:all
lc:; wc -l $(VFILES)
wc:; wc -w $(VFILES)
clean:clean2
clean2:; find . \( -name .\*.aux \) -delete
describe:; git describe --dirty --long --always --abbrev=40 --all
publish-dan:html; rsync -ai html/. u00:public_html/Ktheory/.
Makefile-coq.in: $(patsubst %, Packages/%/.package/files, $(PACKAGES))
	@ echo making $@ ; ( \
	echo '# -*- makefile-gmake -*-' ;\
	echo ;\
	echo '# DO NOT EDIT THIS FILE!' ;\
	echo '# It is made by Makefile' ;\
	echo ;\
	echo '-R Packages Foundations' ;\
	echo ;\
	for i in $(PACKAGES) ;\
	do sed "s=^=Packages/$$i/=" < Packages/$$i/.package/files ;\
	done ;\
	echo ;\
	echo '# Local Variables:' ;\
	echo '# compile-command: "coq_makefile -f Makefile-coq.in -o Makefile-coq.make"' ;\
	echo '# End:' ;\
	) >$@
always:
ifeq ($(REMAKE_FILES),yes)
Makefile-coq.in:always
endif
